#include "pitches.h"
#include "BluetoothSerial.h"

//#define USE_PIN // Uncomment this to use PIN during pairing. The pin is specified on the line below
const char *pin = "1234"; // Change this to more secure PIN.

String device_name = "Estrella";

#if !defined(CONFIG_BT_ENABLED) || !defined(CONFIG_BLUEDROID_ENABLED)
#error Bluetooth is not enabled! Please run make menuconfig to and enable it
#endif

#if !defined(CONFIG_BT_SPP_ENABLED)
#error Serial Bluetooth not available or not enabled. It is only available for the ESP32 chip.
#endif

int led=2;
BluetoothSerial SerialBT;

const int buzzerPin = 27; // Pin donde está conectado el buzzer

const int ledPins[] = {19, 18, 17, 5, 16, 4, 21, 15}; // Pines de los LEDs
const int numLeds = sizeof(ledPins) / sizeof(ledPins[0]);

bool isPlayingSong1 = false;
bool isPlayingSong2 = false;

int jingleBellsMelody[] = {
  // Notas de Jingle Bells van aquí
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_G4, NOTE_C4, NOTE_D4,
  NOTE_E4,
  NOTE_F4, NOTE_F4, NOTE_F4, NOTE_F4,
  NOTE_F4, NOTE_E4, NOTE_E4, NOTE_E4, NOTE_E4,
  NOTE_E4, NOTE_D4, NOTE_D4, NOTE_E4,
  NOTE_D4, NOTE_G4
};

int otherMelody[] = {
  // Notas de la otra canción van aquí
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_G5, NOTE_C5, NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_F5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5, NOTE_D5, NOTE_D5, NOTE_E5,
  NOTE_D5, NOTE_G5
};

int jingleBellsNoteDurations[] = {
  // Duraciones de Jingle Bells van aquí
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300,
  100, 100, 200,
  100, 100, 200,
  100, 100, 100, 300,
  100,
  100, 100, 100, 100,
  100, 100, 100, 100,
  100, 100, 100, 200,
  100, 300
};

int otherNoteDurations[] = {
  // Duraciones de la otra canción van aquí
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200,
  400, 400, 200,
  400, 400, 200,
  400, 400, 400, 400,
  100,
  400, 400, 400, 800, 800,
  400, 400, 400, 400,
  100, 100, 100, 200,
  200, 200
};

void setup() {
  Serial.begin(115200);
  SerialBT.begin(device_name); //Bluetooth device name
  Serial.printf("The device with name \"%s\" is started.\nNow you can pair it with Bluetooth!\n", device_name.c_str());
  //Serial.printf("The device with name \"%s\" and MAC address %s is started.\nNow you can pair it with Bluetooth!\n", device_name.c_str(), SerialBT.getMacString()); // Use this after the MAC method is implemented
  #ifdef USE_PIN
    SerialBT.setPin(pin);
    Serial.println("Using PIN");
  #endif

  for (int i = 0; i < numLeds; ++i) {
    pinMode(ledPins[i], OUTPUT); // Configurar los pines de los LEDs como salida
  }

  pinMode(buzzerPin, OUTPUT);
}

void loop() {
  if (Serial.available()) {
    SerialBT.write(Serial.read());
  }

  String receivedString;

  if (SerialBT.available()) {
    receivedString = SerialBT.readString(); // Read the entire string

    Serial.print("Received: ");
    Serial.println(receivedString);

  }

  if (receivedString == "cancionbt2") {
    isPlayingSong1 = true;
    while (isPlayingSong1) {
      playSong(jingleBellsMelody, jingleBellsNoteDurations, sizeof(jingleBellsMelody) / sizeof(jingleBellsMelody[0]));
    }
  }

  if (receivedString =="cancionbt") {
    isPlayingSong2 = true;
    while (isPlayingSong2) {
      
      playSong(otherMelody, otherNoteDurations, sizeof(otherMelody) / sizeof(otherMelody[0]));
      
    }
  }
}

void playSong(int melody[], int noteDurations[], int length) {
  for (int i = 0; i < length && (isPlayingSong1 || isPlayingSong2); i++) {
    if (melody[i] != 0) {
      tone(buzzerPin, melody[i], noteDurations[i]);

      // Encender y apagar los LEDs al ritmo d..e la música
      for (int j = 0; j < numLeds; j++) {
        digitalWrite(ledPins[j], HIGH);
        delay(10); // Breve parpadeo de los LEDs
        digitalWrite(ledPins[j], LOW);
      }

      if (Serial.available()) {
         SerialBT.write(Serial.read());
      }

      String receivedString;

      if (SerialBT.available()) {
        receivedString = SerialBT.readString(); // Read the entire string

        Serial.print("Received: ");
        Serial.println(receivedString);

        if (receivedString == "off" | digitalRead(buttonPin1) == HIGH) {
          break;
        }
        if (receivedString == "off2") {
          break;
        }
      }

      delay(noteDurations[i]); // Espera entre notas
    } else {
      delay(noteDurations[i]); // Espera si la nota es cero
    }
    
    noTone(buzzerPin);
    delay(50); // Breve pausa entre notas
  }
  isPlayingSong1 = false;
  isPlayingSong2 = false;
}
